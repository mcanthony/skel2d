<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
	<title>skel2d</title>
	<script type="text/javascript" src="../src/gfx.js"></script>
	<script type="text/javascript" src="../src/gfx_path.js"></script>
	<script type="text/javascript" src="../src/skel2d.js"></script>
	<script type="text/javascript" src="../src/skel2d_render.js"></script>
	<style type="text/css">
		html, body, canvas { display: block; margin: 0; padding: 0; width: 100%; height: 100%; }
	</style>
</head>
<body>
<canvas></canvas>
<script type="text/javascript">

var skeleton_data = {
	"bones": [
		{"name": "torso", "length": 100, "rot": 90},
		{"name": "torso.head", "length": 50, "rot": 0, "x": 100},
		{"name": "torso.arm_l", "length": 50, "x": 100, "y": 60, "rot": 115, "sx": 1.3},
		{"name": "torso.arm_l.forearm", "length": 50, "x": 50, "y": 0, "rot": 130},
		{"name": "torso.arm_r", "length": 50, "x": 100, "y": -60, "rot": -50},
		{"name": "torso.arm_r.forearm", "length": 50, "x": 50, "y": 0, "rot": 40},
		{"name": "torso.leg_l", "length": 50, "x": 0, "y": 60, "rot": 170},
		{"name": "torso.leg_l.lower_leg", "length": 50, "x": 50, "y": 0, "rot": 10},
		{"name": "torso.leg_r", "length": 50, "x": 0, "y": -60, "rot": -170},
		{"name": "torso.leg_r.lower_leg", "length": 50, "x": 50, "y": 0, "rot": -10}
	],

	"slots": [
		{"name": "torso.torso", "attachment": "torso"},
		{"name": "torso.head.head", "attachment": "head"},
		{"name": "torso.arm_l.arm", "attachment": "arm"},
		{"name": "torso.arm_r.arm", "attachment": "arm"},
		{"name": "torso.leg_l.leg", "attachment": "leg"},
		{"name": "torso.leg_r.leg", "attachment": "leg"}
	],

	"skins": {
		"default": [
			{"name": "torso.torso.torso", "type": "rect", "line_width": 4, "fill_color": "FFFFFFFF",
			"width": 120, "height": 100, "rot": -90, "y": 60, "border_radius": 0, "line_join": "round"},

			{"name": "torso.head.head.head", "type": "ellipse", "line_width": 4, "fill_color": "FFCC99FF",
			"rx": 80, "ry": 70, "rot": -90, "x": 55, "line_join": "round"},

			{"name": "torso.arm_l.arm.arm", "type": "path", "line_width": 4, "line_cap": "round",
			"commands": [
				"M", 0, 0, "torso.arm_l",
				"Q", 50, 0, "torso.arm_l", 50, 0, "torso.arm_l.forearm"
			]},

			{"name": "torso.arm_r.arm.arm", "type": "path", "line_width": 4, "line_cap": "round",
			"commands": [
				"M", 0, 0, "torso.arm_r",
				"Q", 50, 0, "torso.arm_r", 50, 0, "torso.arm_r.forearm"
			]},

			{"name": "torso.leg_r.leg.leg", "type": "path", "line_width": 4, "line_cap": "round",
			"commands": [
				"M", 0, 0, "torso.leg_r",
				"Q", 50, 0, "torso.leg_r", 50, 0, "torso.leg_r.lower_leg"
			]},

			{"name": "torso.leg_l.leg.leg", "type": "path", "line_width": 4, "line_cap": "round",
			"commands": [
				"M", 0, 0, "torso.leg_l",
				"Q", 50, 0, "torso.leg_l", 50, 0, "torso.leg_l.lower_leg"
			]}
		]
	}
};

var animation_data = {
	"bones": {
		"torso.arm_r.forearm": {
			"rot": [
				{"time": 0.0 / 2, "value": 0, "easing": "sin_out"},
				{"time": 0.5 / 2, "value": -30, "easing": "sin_in"},
				{"time": 1.0 / 2, "value": 0, "easing": "sin_out"},
				{"time": 1.5 / 2, "value": 30, "easing": "sin_in"},
				{"time": 2.0 / 2, "value": 0, "easing": "sin_out"},
				{"time": 2.5 / 2, "value": -30, "easing": "sin_in"},
				{"time": 3.0 / 2, "value": 0, "easing": "sin_out"},
				{"time": 3.5 / 2, "value": 30, "easing": "sin_in"},
				{"time": 4.0 / 2, "value": 0}
			]
		}
	},
	"slots": {
		"torso.torso": {
			"r": [
				{"time": 0.0, "value": 0.0, "easing": "sin_in_out"},
				{"time": 0.5, "value": 0.5, "easing": "sin_in_out"},
				{"time": 1.0, "value": 1.0, "easing": "sin_in_out"},
				{"time": 1.5, "value": 0.5, "easing": "sin_in_out"},
				{"time": 2.0, "value": 0.0}
			],
			"g": [
				{"time": 0, "value": 0},
				{"time": 1, "value": 0},
				{"time": 2, "value": 0}
			],
			"b": [
				{"time": 0.0, "value": 1.0, "easing": "sin_in_out"},
				{"time": 0.5, "value": 0.5, "easing": "sin_in_out"},
				{"time": 1.0, "value": 0.0, "easing": "sin_in_out"},
				{"time": 1.5, "value": 0.5, "easing": "sin_in_out"},
				{"time": 2.0, "value": 1.0}
			]
		}
	}
};

var canvas = document.querySelector("canvas");
var gfx = gfx_create_context(canvas);
var skeleton = new sk2.Skeleton(skeleton_data);
var animation = new sk2.Animation(skeleton, animation_data);
var renderer = new SkeletonRenderer(gfx);
var transform = mat3();

var S = 5;

var bone_points = [
	{x:  0, y:  S},
	{x:  S, y:  0},
	{x:  0, y: -S},
	{x: -S, y:  0}
];

var w = canvas.width = window.innerWidth;
var h = canvas.height = window.innerHeight;

mat3identity(transform);
// mat3scale(3, 3, transform);

gfx.clear_color(1, 1, 1, 1);
gfx.viewport(0, 0, canvas.width, canvas.height);
gfx.projection(mat3ortho(-w/2, w/2, -h/2, h/2, mat3()));
gfx.transform(transform);

requestAnimationFrame(frame);

var t0 = 0;
var t1 = 0;
var time = performance.now() / 1000;

function frame()
{
	var t = performance.now() / 1000;
	var dt = t - time;

	time = t;

	t0 = t1;
	t1 = (t1 + dt) % 2.0;

	animation.apply(skeleton, t0, t1, 1);
	skeleton.update_transform();

	gfx.clear();
	renderer.draw(skeleton, 1);

	requestAnimationFrame(frame);
}

</script>
</body>
</html>
